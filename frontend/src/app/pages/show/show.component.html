<body class="bg-light d-flex flex-column min-vh-100">

  <!-- Header -->
  <app-header></app-header>

  <!-- Contenido principal -->
  <main class="container flex-grow-1">

    <!-- Botones principales -->
<div class="d-flex flex-wrap justify-content-center gap-4 mt-5 mb-5 text-center">
   <div>
    <button 
      class="btn btn-primary btn-lift" 
      (click)="agregar('Juzgado 1° Garantias')" 
      [disabled]="estaDeshabilitado('Juzgado 1° Garantias')">
      Juzgado 1
    </button>
    <div class="mt-1 text-muted">
      {{ countsByCourt['Juzgado 1° Garantias'] || 0 }} registros
    </div>
  </div>

  <div>
    <button 
      class="btn btn-primary btn-lift" 
      (click)="agregar('Juzgado 2° Garantias')" 
      [disabled]="estaDeshabilitado('Juzgado 2° Garantias')">
      Juzgado 2
    </button>
    <div class="mt-1 text-muted" >
      {{ countsByCourt['Juzgado 2° Garantias'] || 0 }} registros
    </div>
  </div>

  <div>
    <button 
      class="btn btn-primary btn-lift" 
      (click)="agregar('Juzgado 3° Garantias')" 
      [disabled]="estaDeshabilitado('Juzgado 3° Garantias')">
      Juzgado 3
    </button>
    <div class="mt-1 text-muted">
      {{ countsByCourt['Juzgado 3° Garantias'] || 0 }} registros
    </div>
  </div>

   <div>
    <button 
      class="btn btn-primary btn-lift" 
      (click)="agregar('Juzgado 4° Garantias')" 
      [disabled]="estaDeshabilitado('Juzgado 4° Garantias')">
      Juzgado 4
    </button>
    <div class="mt-1 text-muted">
      {{ countsByCourt['Juzgado 4° Garantias'] || 0 }} registros
    </div>
  </div>

  <div>
    <button 
      class="btn btn-primary btn-lift" 
      (click)="agregar('Juzgado 5° Garantias')" 
      [disabled]="estaDeshabilitado('Juzgado 5° Garantias')">
      Juzgado 5
    </button>
    <div class="mt-1 text-muted">
      {{ countsByCourt['Juzgado 5° Garantias'] || 0 }} registros
    </div>
  </div>

  <div>
    <button 
      class="btn btn-primary btn-lift" 
      (click)="agregar('Juzgado 6° Garantias')" 
      [disabled]="estaDeshabilitado('Juzgado 6° Garantias')">
      Juzgado 6
    </button>
    <div class="mt-1 text-muted">
      {{ countsByCourt['Juzgado 6° Garantias'] || 0 }} registros
    </div>
  </div>
</div>


  <!-- Tabla -->
  <div class="table-responsive">
    <table class="table table-bordered table-striped align-middle shadow-sm">
      <thead class="table-dark">
        <tr>
          <th scope="col" class="text-center">Número</th>
          <th scope="col" class="text-center">Juzgado</th>
          <th scope="col" class="text-center">Acción</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let reg of registros; let i = index">
          <td class="text-center">{{ reg.numero }}</td>
          <td class="text-center">{{ reg.juzgado }}</td>
          <td class="text-center">
            <button class="btn btn-danger btn-sm" (click)="eliminar(i)"><fa-icon [icon]="fasTrash"></fa-icon></button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Efecto sorteo -->
  <div *ngIf="sorteoEnProgreso || nombreSorteo" class="text-center my-4">
    <div class="alert alert-info fs-4 fw-bold">
      {{ nombreSorteo }}
    </div>
  </div>


    <!-- Botones inferiores -->
    <div class="d-flex justify-content-center gap-3 mt-4 mb-4">
      <button class="btn btn-success" (click)="sortearJuzgado()" [disabled]="sorteoEnProgreso || registros.length === 0">Reparto</button>
      <button class="btn btn-success" (click)="limpiarTabla()">Limpiar</button>
    </div>

  
  <!-- Formulario -->
<div class="card mt-5 shadow-sm border-0">
  <div class="card-header bg-dark text-white text-center fw-bold">
    Registro de Audiencias
  </div>
  <div class="card-body">
    <form (ngSubmit)="enviarFormulario()" #form="ngForm">

      <div class="row">
        <!-- Juzgado -->
        <div class="col-md-6 mb-3">
          <label for="court" class="form-label">Juzgado <span class="text-danger">*</span></label>
          <input
            type="text"
            id="court"
            class="form-control"
            [ngClass]="{'bg-warning fw-bold': court ,'is-invalid': courtField.invalid && courtField.touched}"
            [(ngModel)]="court"
            name="court"
            #courtField="ngModel"
            required
            readonly
          >
          <div *ngIf="courtField.invalid && courtField.touched" class="text-danger small mt-1">
            Debe seleccionar un juzgado.
          </div>
        </div>

      <!-- Radicado -->
        <div class="col-md-6 mb-3">
          <label for="caseNumber" class="form-label">Radicado <span class="text-danger">*</span></label>
          <input
            type="text"
            id="caseNumber"
            class="form-control"
            [ngClass]="{'is-invalid': caseNumberField.invalid && caseNumberField.touched}"
            [(ngModel)]="caseNumber"
            name="caseNumber"
            #caseNumberField="ngModel"
            required
          >
          <div *ngIf="caseNumberField.invalid && caseNumberField.touched" class="text-danger small mt-1">
            Debe ingresar el número de radicado.
          </div>
        </div>
      </div>

      <div class="row">
        <!-- Número de detenidos -->
        <div class="col-md-6 mb-3">
          <label for="numberPeopleCustody" class="form-label">Número de detenidos <span class="text-danger">*</span></label>
          <input
            type="text"
            id="numberPeopleCustody"
            class="form-control"
            [ngClass]="{'is-invalid': numberPeopleField.invalid && numberPeopleField.touched}"
            [(ngModel)]="numberPeopleCustody"
            name="numberPeopleCustody"
            #numberPeopleField="ngModel"
            required
          >
          <div *ngIf="numberPeopleField.invalid && numberPeopleField.touched" class="text-danger small mt-1">
            Debe indicar el número de detenidos.
          </div>
        </div>

        <!-- Tipo de delito -->
        <div class="col-md-6 mb-3">
          <label for="crimeCategory" class="form-label">Tipo de delito <span class="text-danger">*</span></label>
          <input
            type="text"
            id="crimeCategory"
            class="form-control"
            [ngClass]="{'is-invalid': crimeCategoryField.invalid && crimeCategoryField.touched}"
            [(ngModel)]="crimeCategory"
            name="crimeCategory"
            #crimeCategoryField="ngModel"
            required
          >
          <div *ngIf="crimeCategoryField.invalid && crimeCategoryField.touched" class="text-danger small mt-1">
            Debe ingresar el tipo de delito.
          </div>
        </div>
      </div>
      
      <!-- Observaciones -->
      <div class="mb-3">
        <label for="remarksField" class="form-label">Observaciones</label>
        <textarea 
          id="remarksField" 
          class="form-control" 
          [(ngModel)]="remarksField" 
          name="remarksField" 
          rows="3">
        </textarea>
      </div>

      <!-- Botones formulario -->
      <div class="d-flex justify-content-center gap-3">
        <button type="submit" class="btn btn-primary px-4" [disabled]="!form.valid">
          Guardar
        </button>
        <button type="button" class="btn btn-outline-secondary" (click)="limpiarFormulario()">Limpiar</button>
      </div>

    </form>
  </div>
</div>


    <!-- Tabla con registros del formulario -->
  <div class="card mt-5 shadow-sm border-0 w-100">
    <div class="card-header bg-primary text-white text-center fw-bold">
      Registros Guardados
    </div>
    <div class="card-body table-responsive">
      <table class="table table-bordered table-striped align-middle shadow-sm">
        <thead class="table-dark">
          <tr>
            <th scope="col" class="text-center" style="display: none;">Id</th>
            <th scope="col" class="text-center">Fecha Registro</th>
            <th scope="col" class="text-center">Juzgado</th>
            <th scope="col" class="text-center">Radicado</th>
            <th scope="col" class="text-center"># Detenidos</th>
            <th scope="col" class="text-center">Tipo Delito</th>
            <th scope="col" class="text-center" style="width: 250px;">Observaciones</th>
            <th scope="col" class="text-center" style="width: 150px;">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let caseAssignment of caseAssignments; let i = index">
            <td class="text-center">{{ caseAssignment.assignedAt | date:'dd/MM/yyyy HH:mm' }}</td>
            <td class="text-center" style="display: none;">{{ caseAssignment._id }}</td>
            <td class="text-center">{{ caseAssignment.court }}</td>
            <td class="text-center">{{ caseAssignment.caseNumber }}</td>
            <td class="text-center">{{ caseAssignment.numberPeopleCustody }}</td>
            <td class="text-center">{{ caseAssignment.crimeCategory }}</td>
            <td style="width: 250px;">
                 <div class="obs-box">
                  {{ caseAssignment.remarksField }}
                 </div>
            </td>
            <td class="text-center" style="width: 150px; white-space: nowrap;">
              <button [routerLink]="['/update', caseAssignment._id]" 
                class="btn btn-outline-warning btn-sm me-2">
                <fa-icon [icon]="faEdit"></fa-icon>
              </button>
              <button (click)="eliminarRegistro(caseAssignment._id, i)" 
                class="btn btn-outline-danger btn-sm">
                <fa-icon [icon]="fasTrash"></fa-icon>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Boton Tabla Generica -->
    <div class="d-flex justify-content-center gap-3 mt-4 mb-4">
      <button [routerLink]="['/generic-table']" class="btn btn-primary btn-sm me-2 btn-lift">
        Todos los Registros
      </button>
    </div>


  </main>

  <!-- Footer -->
  <app-footer></app-footer>

  <!-- Bootstrap 5.3.7 JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
</body>